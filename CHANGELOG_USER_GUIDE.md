# 📋 사용자 가이드 변경 사항

## 🔄 초기 버전 → 현재 버전 비교

---

## ✨ 주요 추가 사항

### 1. **계정 없이도 참여 가능한 시스템** 🆕

**변경 전:**
- 언급 없음

**변경 후:**
- **선수 등록**: 관리자가 등록하면 계정 없이도 경기 참여 가능
- **선택적 연동**: 원하면 나중에 회원가입 후 계정 연동
- **유연한 참여**: 대회 임시 참가자도 등록 가능

**기술적 배경:**
```
profiles (사용자 계정) ←┐
                       │ 선택적 연결
players (선수 데이터) ──┘ (user_id NULL 가능)
```

---

### 2. **토너먼트 시스템** 🆕

**변경 전:**
- 언급 없음

**변경 후:**
- **대회 유형**: League, Open, Championship
- **대회 기록**: 우승, 준우승, 4강 등 자동 관리
- **개인별 대회 히스토리**: 프로필에서 전체 참가 대회 확인 가능

**구현 테이블:**
- `tournaments`: 대회 정보
- `tournament_results`: 선수별 대회 성적

---

### 3. **대학부 & 동아리부 이중 관리** 🆕

**변경 전:**
- "통합 필터: 우리 학교, 대학부, 동아리 부수별"로 간단히 언급

**변경 후:**
- **대학부**: 1부/2부/3부 (정규 대학 소속 구분)
- **동아리부**: A/B/C/D (동아리 내 실력 등급)
- **독립 랭킹**: 각 부서별로 별도 랭킹 제공
- **조합 필터**: "한양대 1부 A등급" 같은 다중 조건 검색

---

### 4. **레이팅 히스토리 & 그래프** 🆕

**변경 전:**
- "레이팅 그래프: 내 실력이 어떻게 상승(또는 하락)하고 있는지 추이"

**변경 후:**
- **상세 히스토리**: 모든 경기마다 레이팅 변화 기록
- **시각화**: 시간별 레이팅 그래프
- **경기별 상세**: 각 경기의 상대, 결과, 점수 변동
- **데이터베이스**: `rating_history` 테이블로 영구 보관

**예시:**
```
2026-02-06 15:30
홍길동 (1750) vs 김철수 (1650)
결과: 3-1 승리
레이팅: 1750 → 1763 (+13)
```

---

### 5. **자동화된 경기 입력 시스템** 🆕

**변경 전:**
- "입력 버튼을 누르는 순간, 서버가 USATT 차트를 기반으로 점수를 계산"

**변경 후:**
- **자동 처리 프로세스**:
  1. `calculate_usatt_delta()` 함수로 점수 계산
  2. 트리거로 선수 레이팅 자동 업데이트
  3. 트리거로 레이팅 히스토리 자동 생성 (양 선수 2개)
  4. `player_statistics` 뷰 자동 갱신

**구현 함수:**
- `register_match_result()`: 경기 등록 RPC 함수
- `calculate_usatt_delta()`: USATT 델타 계산 함수
- `update_player_ratings_on_match()`: 트리거 함수
- `create_rating_history_on_match()`: 트리거 함수

---

### 6. **사용자 권한 시스템 명확화** 🆕

**변경 전:**
- "지정된 관리자(Admin)만이 경기 결과를 입력"

**변경 후:**
- **3단계 권한 구조**:
  - 비회원 선수: 경기 참여만
  - 일반 회원: 자신의 기록 조회
  - 관리자: 모든 데이터 관리

| 기능 | 비회원 | 일반 회원 | 관리자 |
|------|--------|----------|--------|
| 랭킹 조회 | ✅ | ✅ | ✅ |
| 경기 입력 | ❌ | ❌ | ✅ |
| 선수 관리 | ❌ | ❌ | ✅ |

---

### 7. **순환 관계 감지** 🆕

**변경 전:**
- 언급 없음

**변경 후:**
- A > B > C > A 같은 순환 관계 자동 감지
- Triangle Logic 분석에 포함
- 시각적으로 표시

**예시:**
```
⚠️ 순환 관계 발견!
홍길동 → 김철수 (승)
김철수 → 이영희 (승)
이영희 → 홍길동 (승)
```

---

### 8. **통계 정보 확장** 🆕

**변경 전:**
- "현재 레이팅 점수와 전체 승률"

**변경 후:**
- 현재 레이팅 점수
- 총 경기 수
- 승/패 기록
- 전체 승률 (%)
- **최근 30일 레이팅 변화량** 🆕
- **최근 10경기 상세 기록** 🆕

**구현:**
- `player_statistics` 뷰로 자동 계산
- 실시간 업데이트

---

## 🔧 기술적 개선 사항

### 데이터베이스 구조

**추가된 테이블:**
1. `profiles`: 사용자 계정 (Supabase Auth 연동)
2. `players`: 선수 데이터 (경기 참여 주체)
3. `schools`: 학교 정보
4. `tournaments`: 토너먼트 정보
5. `matches`: 경기 기록
6. `rating_history`: 레이팅 히스토리
7. `tournament_results`: 대회 결과

**추가된 뷰:**
- `player_statistics`: 선수 통계 자동 계산

**추가된 함수:**
- `register_match_result()`: 경기 등록
- `calculate_usatt_delta()`: 레이팅 계산
- `get_player_match_history()`: 경기 히스토리 조회
- `get_player_tournament_history()`: 대회 히스토리 조회
- `calculate_win_probability()`: 승률 예측

---

## 🎯 사용자 경험 개선

### 변경 전
- 회원가입 필수로 인식될 수 있음
- 경기 입력 과정 불명확
- 대학부/동아리부 구분 모호
- 토너먼트 기능 없음

### 변경 후
- **진입 장벽 낮춤**: 계정 없이도 참여 가능
- **투명한 프로세스**: 자동화 과정 상세 설명
- **명확한 구분**: 대학부/동아리부 독립 관리
- **대회 지원**: 토너먼트 시스템 완비
- **상세한 기록**: 모든 경기 히스토리 보관

---

## 📊 추가된 설명

### USATT 레이팅 시스템
- 초기 레이팅: 1500점
- 레이팅 차이에 따른 점수 변동 (8~50점)
- 언더독 보너스 시스템
- 공식 USATT 테이블 기반

### 데이터 입력 방법
- SQL 스크립트
- TypeScript 스크립트
- CSV 파일 가져오기
- Supabase Dashboard GUI

### 보안 시스템
- Row Level Security (RLS)
- 역할 기반 권한 관리
- 서버 사이드 검증

---

## 📝 문서 구성

**새로 생성된 파일:**
1. `USER_GUIDE.md` - 상세 버전 (전체 기능 설명)
2. `USER_GUIDE_SIMPLE.md` - 간단 버전 (핵심만 요약)
3. `CHANGELOG_USER_GUIDE.md` - 변경 사항 비교 (이 문서)
4. `DATA_INPUT_GUIDE.md` - 데이터 입력 가이드
5. `SUPABASE_SETUP.md` - 데이터베이스 설정 가이드

---

## 🎉 결론

초기 설명서는 개념적인 설명에 집중했다면, 현재 버전은:

✅ **실제 구현된 기능** 반영  
✅ **기술적 세부사항** 추가  
✅ **사용자 시나리오** 구체화  
✅ **데이터 구조** 명확화  
✅ **권한 시스템** 상세 설명  
✅ **자동화 프로세스** 투명화

**더 실용적이고 구체적인 가이드로 발전했습니다!** 🚀
